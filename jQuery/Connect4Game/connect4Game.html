<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>

    <meta charset="utf-8">

    <title>Connect4Game</title>

    <link rel="stylesheet" href="Connect4Game.css">
    <link href="jquery-ui/jquery-ui/jquery-ui.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.min.js"></script>
    <script src="jquery-ui/jquery-ui/jquery-ui.js"></script>



  </head>

  <body>

    <div class="gameTitleContainer" align="center">
      <h1>Welcome to connect Four! </h1>
      <h2>Connect 4 chips to win!</h2>
      <h3>Lets start</h3>

      <table class="board">
        <tr>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
        </tr>
        <tr>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
        </tr>
        <tr>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
        </tr>
        <tr>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
        </tr>
        <tr>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
        </tr>
        <tr>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
          <td><button type="button"></button></td>
        </tr>
      </table>
    </div>


    </div>


    <script type="text/javascript">

var player1 = prompt("Player One: Enter your name, you will be Blue");
var player1Color = 'rgb(86, 151, 255)';
//using rgb because we will using jquery to change the actuall color of the buttons, because it expects a string in the form rgb and spacing

var player2 = prompt("Player Two: Enter your name, you will be Red");
var player2Color = 'rgb(237, 45, 73)';

var game_on = true; // bullion to show if game is running or not
var table = $('table tr'); // jquery call to table tr

function reportWin(rowNum,colNum) {
  console.log("You won starting at this row,col");
  console.log(rowNum);
  console.log(colNum);
} // takes in a rowNumber n coloumnNumber, n logs the winning move *not needed, but convenience function for debuggin*

  function changeColor(rowIndex,colIndex,color) {
    return table.eq(rowIndex).find('td').eq(colIndex).find('button').css('background-color', color);
    //will get a table cell value by index-(used to returnColor index of specified element with respect to selector) using jquery n change our color
  }

  function returnColor(rowIndex,colIndex) {
    return table.eq(rowIndex).find('td').eq(colIndex).find('button').css('background-color');
    //will report back the color, @ this row n this color
  }

  // checkBottom function will take in a particular colomn index as someone is clicking and return the bottom row that is still grey and take that one
  function checkBottom(colIndex) {
    var colorReport = returnColor(5,colIndex);
     // will start a 5 because we have a for loop
     //this loop will start at row 5 and keep going (decrease) until will get to 0
     for (var row = 5; row >=0; row--) {
       // for each of these we will grab the colorReport and set it equal to returnColor @ the current row @ the current colorIndex
       colorReport = returnColor(row,colIndex);
      // if the colorReport is = to grey then return that row
      if (colorReport === 'rgb(128, 128, 128)') {
        return row;
      }
     }
  }
// will grab 4 buttons and makes sure 1=2,1=3 etc.. (see note i made bellow)
// //will check if button 1 matches button 2, button 1 matches 3 and 1 matches 4 and CHECK IF THESE BUTTONS ARE NOT GREY BUTTONS
// & check for horizontal n vertical wins
  function colorMatchCheck(one,two,three,four){
    return(one===two && one===three && one===four && one !== 'rgb(128, 128, 128)' && one !== undefined);

    }


    // WIN CHECKS (horizontal, vertical & diagonal checks)

    // For horizontal if will check 4 in a row and move over 1 and check the next 4, etc..
    // for every row there are 4 horizontal checks
    function horizontalWinCheck() {
      //check the 6 rows for 4 coloumns  and do a colorMatchCheck
      for (var row = 0; row < 6; row++) {
        for (var col = 0; col < 4; col++) {
          if (colorMatchCheck(returnColor(row,col), returnColor(row,col+1) ,returnColor(row,col+2), returnColor(row,col+3))) {
            console.log('horiz');
            reportWin(row,col); //will report win and where it occurd
            return true; // return true if there was a horizontalWinCheck
          }else {
            continue; // if not it will continue. Tells code continue n dont do anything else.
          }
        }
      }
    }

    // *SIMILAR TO horizontalWinCheck* For vertical if will check 4 in a column and move up 1 and check the next 4, etc..
    // for every column there are 4 veritical checks
    function verticalWinCheck() {
      for(var col=0; col<7; col++){
        for(var row = 0; row < 3; row++){
          if(colorMatchCheck(returnColor(row,col), returnColor(row+1,col),returnColor(row+2,col),returnColor(row+3,col))){
            console.log('vertical');
            reportWin(row,col);
            return true;
          } else {
            continue;
          }
        }
      }
    }

    // A little different to the 2 above; does checks for slopes neg n pos slopes
    function diagonalWinCheck() {
      for (var col = 0; col < 5; col++) {
        for (var row = 0; row < 7; row++) {
          //Will check positive slopes
          if (colorMatchCheck(returnColor(row,col), returnColor(row+1,col+1) ,returnColor(row+2,col+2), returnColor(row+3,col+3))) {
            console.log('diagonal');
            reportWin(row,col);
            return true;
          } else if (colorMatchCheck(returnColor(row,col), returnColor(row-1,col+1) ,returnColor(row-2,col+2), returnColor(row-3,col+3))) {
            //will check the negative slopes
            console.log('diagonal');
            reportWin(row,col);
            return true;
          }else {
            continue;
          }
        }
      }
    }

    function gameEnd(winningPlayer) {
      for (var col = 0; col < 7; col++) {
        for (var row = 0; row < 7; row++) {
          $('h3').fadeOut('fast');
          $('h2').fadeOut('fast');
          $('h1').text(winningPlayer+" has won! Refresh your browser to play again!").css("fontSize", "50px");
        }
      }
    }

    // START WITH PLAYER 1
    var currentPlayer =1;
    currentName = player1;
    var currentColor = player1Color;
    // NOW INDICATE THIS IS PLAYER 1
    $('h3').text(player1 + " It is your turn, pick a column to drop in" );
    // this function will call all your logic
    $('.board button').click(function(){


        var col = $(this).closest("td").index();  //will recognise which column was chosen. By finding closest cell using index

        var bottomAvail = checkBottom(col); // Get buttom avail row to change
        changeColor(bottomAvail,col,currentColor);     //& CALL changeColor() pass inside ...etc. TO GET CHIP TO DROP IN BUTTOM AVAILABYY

  // NOW check if there is a win or a tie and END THE GAME
    if (horizontalWinCheck() || verticalWinCheck() || diagonalWinCheck()){
      gameEnd(currentName);
    }
    // if there is no win or tie.
    currentPlayer = currentPlayer * -1; //

    if (currentPlayer === 1) { // IF CURRENT PLAYER IS POSITIVE ONE WE KNOW WE ARE WITH PLAYER 1
      currentName = player1;
      $('h3').text(currentName + " it is your turn. ");
      currentColor = player1Color;
    } else {
      currentName = player2;
      $('h3').text(currentName+ " it is your turn. ");
      currentColor = player2Color;
    }

  });


    </script>




  </body>



</html>
